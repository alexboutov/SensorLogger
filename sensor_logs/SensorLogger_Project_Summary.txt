SensorLogger Project Summary - Context & Decisions Log

PROJECT SNAPSHOT
minSdk=26
targetSdk=34
jdk=17
binding=viewBinding
dataBinding=false
compose=false
material=true
activityKtx=true

SESSION REQUESTS

(fill in at start of next session)

CHANGES SINCE LAST SUMMARY

UI updated: replaced two separate START/STOP buttons with a single toggle button (startStopButton).
MainActivity.kt updated accordingly (single click listener, isLogging flag, dynamic label).
Key decision added: before generating drop-in update for any file, current version must be pasted.

Service stability: fixed STOP crash by flipping isLogging=false first, unregistering sensors, cancelling pending write jobs, then closing writers; guarded all writes with isLogging/writersOpen and try/catch.
Write ordering: moved all CSV writes onto a single-threaded dispatcher (FIFO) so events are serialized in submission order.
Timing source: switched linear-acceleration timing to sensor monotonic clock (event.timestamp, ns since boot) to eliminate negative dt; applied sensor timestamps to ACC/GRAV/MAG snapshots as well.
LA CSV schema changed: now logs prevLaTsNs, laTsNs, laClockNs, laX, laY, laZ, P. (dt can be derived as laTsNs - prevLaTsNs.)
Combined CSV updated: sysTs (wall clock) plus per-sensor monotonic timestamps and values for LA/ACC/GRAV/MAG, and P.

OPEN ISSUES

(none for CSV aggregation) - consolidated snapshot CSV implemented and logging on every sensor update. Open new issues as needed.

DONE TODAY

Implemented serialized write queue (single-thread executor) to preserve line order.
Adopted sensor monotonic timestamps; added LA running clock (laClockNs).
Updated per-sensor and combined CSV formats as described; verified non-negative dt on LA.
Retained foreground service and wakelock; app now remains running after STOP and is ready for the next START.

ENVIRONMENT SETUP

Initially, JAVA_HOME was not set; builds failed.
Installed Oracle JDK 17 on Windows and set JAVA_HOME:
C:\Program Files\Java\jdk-17
PATH updated to include %JAVA_HOME%\bin.
Android Studio JBR present at:
C:\Program Files\Android\Android Studio\jbr
(Gradle forced to use real JDK via org.gradle.java.home.)
Removed reliance on "C:\Program Files\Common Files\Oracle\Java\javapath".

GRADLE AND BUILD TOOLS

Gradle wrapper: 8.6
Kotlin: 1.9.20 (from Gradle -v)
Fixed malformed distribution URL in gradle-wrapper.properties earlier.
Forced Gradle JDK:
org.gradle.java.home=C:\ Program Files\Java\jdk-17
settings.gradle uses google() and mavenCentral().

APP AND SDK CONFIGURATION

compileSdk 34
defaultConfig: minSdk 26, targetSdk 34
Java/Kotlin levels: Java 17, jvmTarget 17
Dependencies (core set):
implementation 'androidx.core:core-ktx:1.12.0'
implementation 'androidx.core:core:1.12.0'
implementation 'androidx.appcompat:appcompat:1.6.1'
implementation 'com.google.android.material:material:1.9.0'
implementation 'androidx.constraintlayout:constraintlayout:2.1.4'
implementation 'androidx.activity:activity-ktx:1.8.2'
implementation 'org.jetbrains.kotlinx:kotlinx-coroutines-android:1.7.1'
ViewBinding: ON
Data Binding: OFF
No Room, Retrofit, or Compose.

ANDROIDMANIFEST

Removed package="com.example.sensorlogger" (namespace set in Gradle).
Added:
<uses-permission android:name="android.permission.WAKE_LOCK" />

BUILD AND RUN PROGRESS

Resolved Gradle transform cache issues by killing java.exe and deleting .gradle\caches\transforms-4.
Resolved jlink/JBR issue by forcing Gradle to use JDK 17.
Builds succeed; app deploys and runs on device.
STOP behavior: pressing STOP halts SensorLoggerService without process crash; app remains open and can START again.
Timestamp stability: LA rows now use monotonic sensor timestamps; negative dt eliminated. Combined CSV uses sysTs plus sensor ts for each sensor.
Device connection issue (USB/Wi-Fi): After attempting to connect a different phone, SM-G930V did not appear in the device list despite reconnecting USB, restarting the phone and Android Studio, confirming Developer Options were on, and using Connection Assistant actions (Rescan Devices, Restart ADB Server). Switching to a different laptop USB port immediately made SM-G930V appear. Workaround noted: try a different USB port if the device is missing.

PHYSICAL DEVICE TESTING

Device: Samsung SM-G930V (Android 8.0, API 26)
App runs; START/STOP toggle works; CSV files generated and copied from device; stop/start cycles stable.

KEY DECISIONS AND PREFERENCES

Keep project minimal and focused.
Only essential libraries; avoid optional tech unless explicitly requested.
Before generating drop-in update for any file, the current version of that file must first be pasted/provided in the chat to prevent unintended changes and ensure consistency.
